<!DOCTYPE html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simulador Crédito Automóvel</title>
  <style>
    :root{
      --blue-900:#0b1731;
      --blue-800:#102447;
      --blue-700:#16335f;
      --blue-600:#1d4476;
      --blue-500:#2a5b9a;
      --blue-300:#9fb7d9;
      --silver:#e6ebf2;
      --soft:#d9e3f2;
      --text:#0f1e33;
      --white:#ffffff;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Segoe UI",Arial,sans-serif;
      background:radial-gradient(circle at top left, #1f4d86 0%, #14325f 40%, #0a162d 100%);
      color:var(--text)
    }
    .wrap{max-width:980px;margin:32px auto;padding:0 16px}
    .panel{background:var(--white);border-radius:18px;box-shadow:0 20px 40px rgba(5,12,24,0.35);overflow:hidden}
    .section{display:grid;grid-template-columns:1.2fr 1fr;align-items:center;padding:18px 22px;gap:18px}
    .section + .section{border-top:6px solid var(--blue-700)}
    .section.green{background:linear-gradient(135deg, var(--blue-700), var(--blue-500))}
    .section.light{background:var(--soft)}
    h2{margin:0;font-size:28px;color:var(--white)}
    .section.light h2{color:var(--blue-800)}
    .sub{margin:6px 0 0;font-size:18px;color:var(--blue-700);font-weight:600}
    .section.green .sub{color:var(--blue-300)}
    .control{display:flex;align-items:center;justify-content:flex-end;gap:12px}
    .control button{width:36px;height:36px;border-radius:50%;border:2px solid var(--blue-700);background:transparent;font-weight:bold;color:var(--blue-700);font-size:18px;cursor:pointer;padding:0;display:inline-flex;align-items:center;justify-content:center;flex:0 0 36px;line-height:1}
    .value{background:var(--silver);border-radius:10px;padding:10px 16px;min-width:160px;text-align:center;border:2px solid var(--blue-700);font-size:22px;font-weight:700;color:var(--blue-800)}
    .value small{display:block;font-size:13px;font-weight:600;color:var(--blue-600)}
    .slider-wrap{display:flex;align-items:center;gap:12px}
    input[type="range"]{width:100%;accent-color:var(--blue-700)}
    .inputs{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:18px}
    label{display:block;font-size:13px;color:var(--silver);font-weight:600;margin-bottom:6px}
    input[type="number"]{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #b0c1da;font-size:16px;background:var(--silver);color:var(--blue-800)}
    .note{margin-top:14px;font-size:12px;color:#c6d3e6}
    .docs-info{margin-top:20px;background:rgba(255,255,255,0.95);border:1px solid #b0c1da;border-radius:14px;padding:16px 18px;color:var(--blue-800)}
    .docs-info h3{margin:0 0 10px;font-size:18px;color:var(--blue-700)}
    .docs-info ul{margin:0;padding-left:20px;display:grid;gap:8px}
    .docs-info li{line-height:1.35}
    @media (max-width:760px){
      .section{grid-template-columns:1fr}
      .control{justify-content:flex-start}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <div class="section green">
        <div>
          <h2>O montante que preciso</h2>
          <div class="sub">De 0€ até 75.000€</div>
        </div>
        <div class="control">
          <button type="button" onclick="stepMontante(-500)">−</button>
          <div class="value" id="montanteLabel">0 €</div>
          <button type="button" onclick="stepMontante(500)">+</button>
        </div>
      </div>

      <div class="section light">
        <div>
          <h2>A minha mensalidade desde</h2>
          <div class="sub">Mensalidade mínima aplicada a esta simulação</div>
        </div>
        <div class="control">
          <button type="button" onclick="stepPrestacao(-5)">−</button>
          <div class="value" id="prestacaoLabel">—</div>
          <button type="button" onclick="stepPrestacao(5)">+</button>
        </div>
      </div>

      <div class="section green">
        <div>
          <h2>Em quantos meses</h2>
          <div class="sub" id="prazoSub">De 60 a 120 meses</div>
        </div>
        <div class="control slider-wrap">
          <button type="button" onclick="stepPrazo(-12)">−</button>
          <input type="range" id="prazo" min="60" max="120" step="12" value="60" />
          <button type="button" onclick="stepPrazo(12)">+</button>
          <div class="value" id="prazoLabel">60 MESES<small>5 anos</small></div>
        </div>
      </div>
    </div>

    <div class="inputs">
      <div>
        <label for="pvp">PVP (€)</label>
        <input type="number" id="pvp" min="0" max="75000" step="1" />
      </div>
      <div>
        <label for="entrada">Entrada inicial (€)</label>
        <input type="number" id="entrada" min="0" max="75000" step="500" />
      </div>
    </div>

    <div class="note">Os valores das rendas apresentados são meramente indicativos.<br>Nota: despesas iniciais como o ISUC, comissão de abertura, seguros de vida e despesas de transferência de propriedade não estão incluídas no cálculo, que deve ser entendido como estando sujeito a alterações e atualizações.</div>
    </div>

    <div class="docs-info">
      <h3>DOCUMENTOS PARA FINANCIAMENTO</h3>
      <ul>
        <li>Cartão de cidadão do cliente e cônjuge</li>
        <li>Comprovativo do NIB</li>
        <li>3 recibos de vencimentos do cliente e cônjuge</li>
        <li>Última declaração de IRS (ou código de validação)</li>
        <li>Comprovativo de morada com menos de 2 meses</li>
      </ul>
    </div>
  </div>

  <script>
    const PRAZO_MIN = 60;

    const montanteLabel = document.getElementById('montanteLabel');
    const prestacaoLabel = document.getElementById('prestacaoLabel');
    const prazo = document.getElementById('prazo');
    const prazoLabel = document.getElementById('prazoLabel');
    const prazoSub = document.getElementById('prazoSub');
    const pvp = document.getElementById('pvp');
    const entrada = document.getElementById('entrada');

    const formatEUR = value => value.toLocaleString('pt-PT', { style: 'currency', currency: 'EUR' });

    function clamp(value, min, max) {
      return Math.max(min, Math.min(max, value));
    }

    function getMontante() {
      const total = Number(pvp.value || 0) - Number(entrada.value || 0);
      return clamp(total, 0, 75000);
    }

    // TAN por prazo com acréscimo de +1 p.p.
    function getTAN(meses) {
      if (meses <= 24) return 0.1050;
      if (meses <= 48) return 0.1206;
      if (meses <= 71) return 0.1281;
      if (meses <= 80) return 0.1306;
      if (meses <= 84) return 0.1315;
      if (meses <= 96) return 0.1130;
      return 0.1135;
    }

    // TAEG acompanha o ajuste de +1 p.p. pedido
    function getTAEG(meses) {
      return getTAN(meses) + 0.01;
    }

    // Prazo máximo depende do montante (observado no simulador)
    function getPrazoMax(montante) {
      if (montante <= 5000) return 84;
      if (montante <= 9500) return 96;
      return 120;
    }

    function syncPrazoRange() {
      const montante = getMontante();
      const maxMeses = getPrazoMax(montante);

      prazo.max = maxMeses;
      if (prazoSub) prazoSub.textContent = `De ${PRAZO_MIN} a ${maxMeses} meses`;

      if (Number(prazo.value) > maxMeses) {
        prazo.value = maxMeses;
        updatePrazo();
      }
    }

    function updateMontante() {
      const montante = getMontante();

      montanteLabel.textContent = formatEUR(montante);
      syncPrazoRange();
      updatePrestacao();
    }

    function updatePrazo() {
      const meses = Number(prazo.value);
      const anos = Math.round(meses / 12);
      prazoLabel.innerHTML = `${meses} MESES<small>${anos} anos</small>`;
      updatePrestacao();
    }

    function calcPrestacao() {
      const montante = getMontante();
      const meses = Number(prazo.value);
      const i = getTAN(meses) / 12;

      if (i === 0) return montante / meses;

      const numerador = i * Math.pow(1 + i, meses);
      const denominador = Math.pow(1 + i, meses) - 1;
      return montante * (numerador / denominador);
    }

    function updatePrestacao() {
      const prestacao = calcPrestacao();
      prestacaoLabel.textContent = formatEUR(prestacao);
    }

    function stepMontante(delta) {
      const novo = clamp(getMontante() + delta, 0, 75000);
      pvp.value = novo + Number(entrada.value || 0);
      updateMontante();
    }

    function stepPrestacao(delta) {
      const prestacaoAtual = calcPrestacao();
      const alvo = Math.max(0, prestacaoAtual + delta);
      const meses = Number(prazo.value);
      const i = getTAN(meses) / 12;

      let montante = 0;
      if (i === 0) {
        montante = alvo * meses;
      } else {
        const fator = (Math.pow(1 + i, meses) - 1) / (i * Math.pow(1 + i, meses));
        montante = alvo * fator;
      }

      pvp.value = clamp(montante + Number(entrada.value || 0), 0, 75000);
      updateMontante();
    }

    function stepPrazo(delta) {
      const max = Number(prazo.max);
      const novo = clamp(Number(prazo.value) + delta, PRAZO_MIN, max);
      prazo.value = novo;
      updatePrazo();
    }

    pvp.addEventListener('input', updateMontante);
    entrada.addEventListener('input', updateMontante);
    prazo.addEventListener('input', updatePrazo);

    updateMontante();
    updatePrazo();
  </script>
</body>
</html>

<!-- Polimento Cetelem: commit message melhorado -->
